---
title: 02-如何链接开源游戏服务端框架
showLastUpdateAuthor: true
sidebar_position: 2
---
示例项目以nakama为例，其他服务端框架或许可以参照相同思路

nakama 项目地址： https://github.com/heroiclabs/nakama

nakama lua sdk 项目地址： https://github.com/heroiclabs/nakama-defold

### 1.部署nakama

a. 部署需要使用docker compmpose，下载教程参照 [Doc](../category/02-服务端部署)

b. 下载、安装并启动docker compose后，在服务端目录（maps\EntryMap\script\backend\nakama）下执行命令
```
docker-compose up --build -d
```
### 2.修改测试脚本

测试脚本在 maps\EntryMap\script\main.lua中, 改动如下
```main.lua
y3.game:event('键盘-按下', 'SPACE', function ()
    print('你按下了空格键！')
    <!-- 注释这一行，启动下一行 run_websocket_test() -->
    nakama_test()
end)
```

### 3.启动示例项目

启动示例项目后按空格即可触发测试逻辑，默认会链接上nakama服务端，并加入一个聊天频道，支持在频道中发送消息


### 4.如何让你的项目也能链接nakama？

    a. 拷贝Python脚本到您的项目关卡下的相同路径（每个关卡下的\custom_eca\custom_python.py）

    b. 编辑器内保存项目（必要步骤，否则lua无法调用到定义的py函数）

    c. 拷贝Lua脚本到您的项目关卡下的相同路径

    d. 拷贝nakama-lua-sdk脚本到您的项目关卡下的相同路径


### 5.nakama-lua-sdk的修改

该客户端sdk默认是基于defold引擎的，为了让它支持y3，实现了maps\EntryMap\script\nakama-lua-sdk\nakama\engine\y3.lua

实现思路以及规范参照该文档文末 https://github.com/heroiclabs/nakama-defold/blob/master/README.md

对于nakama之外的服务端框架，可参照官方文档，查看是否有defold引擎（或其他基于lua的游戏引擎）的sdk，再查看该sdk文档中是否支持适配其他引擎

>nakama-defold-sdk文档中关于如何适配其他引擎的指引
>The engine module must provide the following functions:
>
>* `http(config, url_path, query_params, method, post_data, cancellation_token, callback)` - Make HTTP request.
>  * `config` - Config table passed to `nakama.create()` or `satori.create()`
>  * `url_path` - Path to append to the base uri
>  * `query_params` - Key-value pairs to use as URL query parameters
>  * `method` - "GET", "POST"
>  * `post_data` - Data to post
>  * `cancellation_token` - Check if `cancellation_token.cancelled` is true
>  * `callback` - Function to call with result (response)
>
>* `socket_create(config, on_message)` - Create socket. Must return socket instance (table with engine specific socket state).
>  * `config` - Config table passed to `nakama.create()` or `satori.create()
>  * `on_message` - Function to call when a message is sent from the server
>
>* `socket_connect(socket, callback)` - Connect socket.
>  * `socket` - Socket instance returned from `socket_create()`
>  * `callback` - Function to call with result (ok, err)
>
>* `socket_disconnect(socket)` - Disonnect socket.
>  * `socket` - Socket instance returned from `socket_create()`
>
>* `socket_send(socket, message)` - Send message on socket.
>  * `socket` - Socket instance returned from `socket_create()`
>  * `message` - Message to send
> 
>* `uuid()` - Create a UUID

